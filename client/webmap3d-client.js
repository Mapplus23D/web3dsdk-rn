!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.client=n():e.client=n()}(self,(()=>(()=>{"use strict";var e,n,t,i,o,r,a,c,s,d,l,u,f,T,L,E,O,p,N,R,I,m,A,S,g,C,_,M,h,y,v={d:(e,n)=>{for(var t in n)v.o(n,t)&&!v.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},G={};v.r(G),v.d(G,{createClient:()=>F}),function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_CENTER=1]="TOP_CENTER",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.CENTER_LEFT=3]="CENTER_LEFT",e[e.CENTER=4]="CENTER",e[e.CENTER_RIGHT=5]="CENTER_RIGHT",e[e.BOTTOM_LEFTL=6]="BOTTOM_LEFTL",e[e.BOTTOM_CENTER=7]="BOTTOM_CENTER",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(e||(e={})),function(e){e[e.S3M=0]="S3M",e[e.S3MGroup=1]="S3MGroup"}(n||(n={})),function(e){e[e.SMALL=0]="SMALL",e[e.MEDIUM=1]="MEDIUM",e[e.LARGE=2]="LARGE"}(t||(t={})),function(e){e[e.CALM=0]="CALM",e[e.SLIGHT=1]="SLIGHT",e[e.MILD=2]="MILD",e[e.MODERATE=3]="MODERATE"}(i||(i={})),function(e){e[e.SUPERMAP=0]="SUPERMAP",e[e.TIANDITU=1]="TIANDITU",e[e.BING=2]="BING",e[e.TEMPLATE=3]="TEMPLATE",e[e.SCT=4]="SCT",e[e.GRID=5]="GRID",e[e.CHANGGUANG=6]="CHANGGUANG",e[e.LOCAL=10]="LOCAL"}(o||(o={})),function(e){e[e.WebMercatorTilingScheme=0]="WebMercatorTilingScheme",e[e.GeographicTilingScheme=1]="GeographicTilingScheme",e[e.GCJ02TilingScheme=2]="GCJ02TilingScheme"}(r||(r={})),function(e){e.AERIAL="Aerial",e.AERIAL_WITH_LABELS="AerialWithLabels",e.AERIAL_WITH_LABELS_ON_DEMAND="AerialWithLabelsOnDemand",e.ROAD="Road",e.ROAD_ON_DEMAND="RoadOnDemand",e.CANVAS_DARK="CanvasDark",e.CANVAS_LIGHT="CanvasLight",e.CANVAS_GRAY="CanvasGray",e.ORDNANCE_SURVEY="OrdnanceSurvey",e.COLLINS_BART="CollinsBart"}(a||(a={})),function(e){e.CIA_C="cia_c",e.CIA_W="cia_w",e.IMG_C="img_c",e.IMG_W="img_w",e.TER_C="ter_c",e.TER_W="ter_w",e.VEC_C="vec_c",e.VEC_W="vec_w"}(c||(c={})),function(e){e[e.windowBlinds=1]="windowBlinds",e[e.shimmer=2]="shimmer",e[e.fadeIn=3]="fadeIn",e[e.slideLeft=4]="slideLeft",e[e.slideRight=5]="slideRight",e[e.slideTop=6]="slideTop",e[e.slideBottom=7]="slideBottom",e[e.pushAside=8]="pushAside"}(s||(s={})),function(e){e.WEATHER="weather"}(d||(d={})),function(e){e.forward_around_backward="forward_around_backward",e.forward="forward",e.backward="backward"}(l||(l={})),function(e){e[e.Proportion=0]="Proportion",e[e.Uniform=1]="Uniform",e[e.AlongDirection=2]="AlongDirection"}(u||(u={})),function(e){e[e.TRANSLATION=0]="TRANSLATION",e[e.ROTATION=1]="ROTATION",e[e.SCALE=2]="SCALE",e[e.LINEGROW=3]="LINEGROW",e[e.COLOR=4]="COLOR",e[e.VISIBILITY=5]="VISIBILITY",e[e.POLYGONGROW=6]="POLYGONGROW"}(f||(f={})),function(e){e.CGCS2000="CGCS2000",e.WGS84="WGS84",e.XIAN80="XIAN80"}(T||(T={})),function(e){e[e.Space=0]="Space",e[e.Ground=1]="Ground",e[e.S3mModel=2]="S3mModel",e[e.Raster=3]="Raster"}(L||(L={})),function(e){e.NONE="NONE",e.TERRAIN="TERRAIN",e.S3M_TILE="S3M_TILE",e.BOTH="BOTH"}(E||(E={})),function(e){e[e.NONE=0]="NONE",e[e.CLAMP_TO_GROUND=1]="CLAMP_TO_GROUND",e[e.RELATIVE_TO_GROUND=2]="RELATIVE_TO_GROUND"}(O||(O={})),function(e){e[e.top=1]="top",e[e.center=2]="center",e[e.baseline=3]="baseline",e[e.bottom=4]="bottom"}(p||(p={})),function(e){e[e.left=1]="left",e[e.center=2]="center",e[e.right=3]="right"}(N||(N={})),function(e){e[e.FILL=1]="FILL",e[e.FILL_AND_OUTLINE=2]="FILL_AND_OUTLINE",e[e.OUTLINE=3]="OUTLINE"}(R||(R={})),function(e){e[e.solid=1]="solid",e[e.dashed=2]="dashed",e[e.contour=3]="contour",e[e.arrow=4]="arrow",e[e.halo=5]="halo",e[e.wake=6]="wake",e[e.dynamic=7]="dynamic"}(I||(I={})),function(e){e[e.CatmullRom=1]="CatmullRom",e[e.Hermite=2]="Hermite"}(m||(m={})),function(e){e[e.nofill=0]="nofill",e[e.solid=1]="solid",e[e.gridding=2]="gridding",e[e.stripe=3]="stripe",e[e.image=4]="image",e[e.feather=5]="feather"}(A||(A={})),function(e){e[e.NONE=1]="NONE",e[e.RAIN=2]="RAIN",e[e.SNOW=3]="SNOW"}(S||(S={})),function(e){e[e.OneOne=0]="OneOne",e[e.Standard=1]="Standard",e[e.Add=2]="Add",e[e.Multiply=3]="Multiply",e[e.MultiplyAdd=4]="MultiplyAdd"}(g||(g={})),function(e){e[e.LINE=0]="LINE",e[e.CIRCLE=1]="CIRCLE"}(C||(C={})),function(e){e[e.MORPHING=0]="MORPHING",e[e.COLUMBUS_VIEW=1]="COLUMBUS_VIEW",e[e.SCENE2D=2]="SCENE2D",e[e.SCENE3D=3]="SCENE3D"}(_||(_={})),function(e){e[e.SolidPoint=0]="SolidPoint",e[e.Billboard=1]="Billboard",e[e.Label=2]="Label",e[e.TerrainLabel=3]="TerrainLabel",e[e.Model=4]="Model",e[e.SolidLine=10]="SolidLine",e[e.DashedLine=11]="DashedLine",e[e.ContourLine=12]="ContourLine",e[e.ArrowLine=13]="ArrowLine",e[e.HaloLine=14]="HaloLine",e[e.ImageLine=19]="ImageLine",e[e.WallLine=17]="WallLine",e[e.SolidRegion=20]="SolidRegion",e[e.GridRegion=21]="GridRegion",e[e.StripeRegion=22]="StripeRegion",e[e.ImageRegion=23]="ImageRegion",e[e.ContourRegion=24]="ContourRegion",e[e.WaterRegion=25]="WaterRegion",e[e.FeatherRegion=26]="FeatherRegion",e[e.ColumnModel=32]="ColumnModel"}(M||(M={})),function(e){e[e.NONE=0]="NONE",e[e.SELECT=1]="SELECT",e[e.TOUCH=2]="TOUCH",e[e.TRANSLATION=3]="TRANSLATION",e[e.MAGNIFIER=4]="MAGNIFIER"}(h||(h={})),function(e){e.Area="Area",e.Distance="Distance",e.DVH="DVH"}(y||(y={}));const D={LineType:I,AnimatorType:f,ClampType:L,BingMapsStyle:a,ProviderType:o,TiandituMapsStyle:c,ClassificationType:E,PolygonGrowType:u,ScreenPosition:e,FillType:A,SceneAction:h,HeightReference:O,SceneAnimationType:d,WeatherType:S,SlideTransitionType:s,SceneMode:_,ScanEffectMode:C,FlyPresetType:l,MeasureType:y,EllipsoidType:T,PrimitiveType:M,SLineType:m,TilingSchemeType:r,VerticalOrigin:p};class b{constructor(){this.resolve=()=>{},this.reject=()=>{},this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}const w=36700160,P=10485760;let H=0;function W(e,n){const{sendHandler:t,handleLargeMessage:i,decodeLargeMessage:o}=e,r={},a={},c=function(){const e=new Map;return{addListener:function(n,t){let i=e.get(n);void 0===i&&(i=[]),i.push(t),e.set(n,i)},removeListener:function(n,t){const i=e.get(n);if(void 0!==i)if(void 0!==t){const e=i.indexOf(t);e>-1&&i.splice(e,1)}else e.set(n,[])},emitEvent:function(...n){const t=n[0],i=n[1],o=e.get(t);o&&o.length>0&&o.map((e=>{e(i)}))}}}(),s=(e,n)=>"bigint"==typeof n?n.toString():n;function d(e,n=!0){let o="";try{o=JSON.stringify(e,s)}catch(e){}let r=!1;if(n&&i){const n=i(o,w);if(n.isLarge){r=!0;const t=n.message,i=t.length,o=Math.ceil(i/P),a=1e3*Math.random();for(let n=0;n<o;n++){const i=t.substring(n*P,(n+1)*P);d({supermap:"supermap",instanceId:e.instanceId,event:"packet",data:{id:a+"",total:o,current:n,payload:i}},!1)}}}r||t(o)}function l(e,n){return`${e}_${n}`}function u(e,t,i){d({supermap:"supermap",instanceId:n,event:"function_returns",data:{functionName:e.functionName,functionId:e.functionId,result:t,status:i}})}const f=new Map;return{addListener:(e,n)=>{c.addListener(e,n)},removeListener:(e,n)=>{c.removeListener(e,n)},emitEvent:function(...e){c.emitEvent(...e)},postEvent:function(...e){c.emitEvent(...e),d({supermap:"supermap",instanceId:n,event:"event",data:e})},bindRemoteFunction:function(e){return(...t)=>function(e,t){const i=H++,o=new b;return a[l(e,i)]=o,d({supermap:"supermap",instanceId:n,event:"invoke_function",data:{functionName:e,functionId:i,params:t}}),o.promise}(e,t)},defineLocalFunction:function(e,n){r[e]=n},receiveMessage:function e(t){t.instanceId===n&&("packet"===t.event?function(n){if(!o)return;const t=n.data.id;if(f.has(t)){const e=f.get(t);if(!e)return;e.push(n.data.payload)}else f.set(t,[n.data.payload]);const i=f.get(t);if(i&&i.length===n.data.total){const n=i.join(""),r=o(n);try{e(JSON.parse(r)),f.delete(t)}catch(e){}}}(t):"invoke_function"===t.event?function(e){const n=e.functionName,t=r[n];if(t){const n=t(...e.params);Promise.resolve(n).then((n=>{u(e,n,"success")})).catch((n=>{u(e,n,"fail")}))}else u(e,`no such method: ${e.functionName}`,"fail")}(t.data):"function_returns"===t.event?function(e){if(e.status){const n=l(e.functionName,e.functionId);"success"===e.status?a[n].resolve(e.result):a[n].reject(e.result),delete a[n]}}(t.data):"event"===t.event&&c.emitEvent(...t.data))},getFunctionList:function(){return Object.keys(r)}}}var B=function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{s(i.next(e))}catch(e){r(e)}}function c(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}))};let U=0;function F(e){const n=++U,t=W(e,n),i=W(e,-1);let o=!1;const r=Object.assign({init:(...e)=>B(this,[...e],void 0,(function*(e="Container",a){if(!o)try{o=!0;const c=i.bindRemoteFunction("createServer");!function(e){const n=["camera","trackingLayer","particleLayers","scanEffect"];e.forEach((e=>{try{const i=e.split("#"),o=i[0],a=i[1];n.includes(o)?("scene"in r||(r.scene={}),o in r.scene||(r.scene[o]={}),r.scene[o][a]=t.bindRemoteFunction(e)):(o in r||(r[o]={}),r[o][a]=t.bindRemoteFunction(e))}catch(e){console.error(e)}}))}(yield c(n,e,a))}catch(e){console.warn("init",e)}})),handleMessage:e=>{try{const n=JSON.parse(e);if("event"in n&&"data"in n){const e=n;t.receiveMessage(e),i.receiveMessage(e)}}catch(e){}},destroy:()=>B(this,void 0,void 0,(function*(){if(o)try{o=!1;const e=i.bindRemoteFunction("destroyServer");yield e(n)}catch(e){console.warn("destroy",e)}})),addListener:(e,n)=>{t.addListener(e,n)},removeListener:(e,n)=>{t.removeListener(e,n)}},D);return r}return G})()));